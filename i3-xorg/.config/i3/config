############################################
# Autostart applications/services on login #
############################################

# Authentication agent (lxpolkit)
exec --no-startup-id lxpolkit

# Set xss-lock
exec --no-startup-id xss-lock -l -- i3lock-fancy -f "JetBrains-Mono-Medium-Nerd-Font-Complete"

# Desktop notifications (dunst)
exec --no-startup-id dunst

# NetworkManager-applet
exec --no-startup-id nm-applet

# Bluetooth applet (blueman)
exec --no-startup-id blueman-applet

# File manager daemon (pcmanfm)
exec --no-startup-id pcmanfm -d

# Set wallpaper
exec --no-startup-id nitrogen --restore

# Polybar
exec_always --no-startup-id ~/.config/polybar/launch.sh

# TODO: - picom
#       - volumeicon (?)
#       - tmux daemon

# TODO
# Compositor (picom)
# exec / exec_always (???)
# exec_always --no-startup-id picom --experimental-backends -b
exec --no-startup-id picom -b

# num lock activated
#exec --no-startup-id numlockx on

# configure multiple keyboard layouts and hotkey to switch (Alt+CAPSLOCK in this example)
#exec --no-startup-id setxkbmap -layout 'us,sk' -variant altgr-intl,qwerty -option 'grp:alt_caps_toggle'

# set powersavings for display:
#exec --no-startup-id xset s 480 dpms 600 600 600

# disable power saving (for example if using xscreensaver)
#exec --no-startup-id xset -dpms

# use xautolock to use autosuspend rules for mobile devices
# https://wiki.archlinux.org/title/Session_lock#xautolock
#exec --no-startup-id xautolock -time 60 -locker "systemctl suspend"

# xscreensaver
# https://www.jwz.org/xscreensaver
#exec --no-startup-id xscreensaver --no-splash

# autotiling script
# https://github.com/nwg-piotr/autotiling
# `yay -S autotiling ;) (it is in AUR)
#exec_always --no-startup-id autotiling

# clipman-applet
#exec --no-startup-id xfce4-clipman
# TODO


##########
# Global #
##########

# Includes
include ~/.config/i3/workspace_kb.conf
include ~/.config/i3/window_kb.conf

# Set font
font pango: JetBrains Mono Medium Nerd Font 10

# Set mod->winkey and alt:
set $mod Mod4
set $alt Mod1

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# Focus doesn't follow mouse
# focus_follows_mouse no

# default i3 tiling mode:
workspace_layout default

# No border nor title
default_border none
default_floating_border none

# Set inner gaps
# gaps inner 10


#########
# Modes #
#########

# Resize window (you can also use the mouse for that)
mode "resize" {
        bindsym h resize shrink width 10 px or 5 ppt
        bindsym k resize grow height 10 px or 5 ppt
        bindsym j resize shrink height 10 px or 5 ppt
        bindsym l resize grow width 10 px or 5 ppt

        # back to normal: Enter or Escape or $mod+r
        bindsym Return mode "default"
        bindsym Escape mode "default"
        bindsym $mod+r mode "default"
}

bindsym $mod+r mode "resize"


####################
# Misc keybindings #
####################

# Start a terminal
bindsym $mod+Return exec alacritty

# Start firefox
bindsym $mod+w exec firefox

# Kill focused window
bindsym $mod+q kill

# Make screenshot
bindsym Print exec ~/.config/i3/scripts/screenshot.sh
bindsym Shift+Print exec ~/.config/i3/scripts/screenshot.sh -s

# Lock by blurring the screen:
bindsym $mod+x exec loginctl lock-session

# Reload the configuration file
bindsym $mod+Shift+c reload

# Restart i3 inplace (preserves your layout/session, can be used to update i3)
bindsym $mod+Shift+r restart


#############
# XF86 keys #
#############

# Backlight control
bindsym XF86MonBrightnessUp exec ~/.config/i3/scripts/brightness.sh -i 5
bindsym XF86MonBrightnessDown exec ~/.config/i3/scripts/brightness.sh -d 5

# Volume control
bindsym XF86AudioMute exec amixer -D pulse sset Master toggle
bindsym XF86AudioRaiseVolume exec amixer -D pulse sset Master 5%+
bindsym XF86AudioLowerVolume exec amixer -D pulse sset Master 5%-
bindsym $mod+XF86AudioRaiseVolume exec amixer -D pulse sset Master 1%+
bindsym $mod+XF86AudioLowerVolume exec amixer -D pulse sset Master 1%-

# Media control
bindsym XF86AudioPlay exec playerctl play
bindsym XF86AudioPause exec playerctl pause
bindsym XF86AudioNext exec playerctl next
bindsym XF86AudioPrev exec playerctl previous

# TODO
# Redirect sound to headphones
# bindsym $mod+p exec /usr/local/bin/switch-audio-port
# TODO


#######################
# Workspace behaviour #
#######################

# Define names for default workspaces
set $ws1 "1: "
set $ws2 "2: "
set $ws3 "3: "
set $ws4 "4: "
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8: "
set $ws9 "9:ﭮ "
set $ws10 "10: "

# Use workspaces on different displays:
# you can get from xrandr command
#workspace $ws1 output VGA-0
#workspace $ws2 output VGA-0
#workspace $ws3 output HDMI-0
#workspace $ws4 output HDMI-0
#workspace $ws5 output HDMI-0

# Bind program to workspace and focus to them on startup:
# assign [class="Alacritty"] $ws1
assign [class="^firefox$"] $ws2
assign [class="^Virt-manager$"] $ws3

assign [class="^ghidra-Ghidra$"] $ws4
assign [class="^jetbrains-idea-ce$"] $ws4

assign [class="^Thunderbird$"] $ws8
assign [class="^discord$"] $ws9
assign [class="^TelegramDesktop$"] $ws10

# Automatic set focus new window if it opens on another workspace then the current:
for_window [class="^Alacritty$"] focus
for_window [class="^firefox$"] focus
for_window [class="^Virt-manager$"] focus
for_window [class="^ghidra-Ghidra$"] focus
for_window [class="^jetbrains-idea-ce$"] focus
for_window [class="^Thunderbird$"] focus
for_window [class="^discord$"] focus
for_window [class="^TelegramDesktop$"] focus


####################
# Floating windows #
####################

for_window [class="^Nm-connection-editor$"] floating enable
for_window [class="^Virt-manager$" title="^Virtual Machine Manager$"] floating enable
for_window [class="^ghidra-Ghidra$" title="^Ghidra: "] floating enable
for_window [class="^jetbrains-idea-ce$" title="^splash$"] floating enable

# TODO
# Set floating (nontiling) for apps needing it
for_window [class="Yad" instance="yad"] floating enable
for_window [class="Galculator" instance="galculator"] floating enable
for_window [class="Blueberry.py" instance="blueberry.py"] floating enable

# Set floating (nontiling) for special apps
for_window [class="Xsane" instance="xsane"] floating enable
for_window [class="Pavucontrol" instance="pavucontrol"] floating enable
for_window [class="qt5ct" instance="qt5ct"] floating enable
for_window [class="Bluetooth-sendto" instance="bluetooth-sendto"] floating enable
for_window [class="Pamac-manager"] floating enable
for_window [window_role="About"] floating enable
# TODO

# Set size of floating window
for_window [floating class=".*"] move position center, resize set 640 480

# Make the currently focused window a scratchpad
bindsym $mod+Shift+minus [floating] move scratchpad

# Show the first scratchpad window
bindsym $mod+minus scratchpad show


##############
# Rofi menus #
##############

# Applications menu
bindsym $mod+space exec rofi -show drun

# Power menu
bindsym $mod+Shift+x exec ~/.config/i3/scripts/powermenu.sh

# TODO
# Power Profiles menu switcher (rofi)
# bindsym $mod+Shift+p exec ~/.config/i3/scripts/power-profiles
# TODO
